<Window x:Class="WPF_HCI.MainWindow"
        x:Name="WindowRoot"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:WPF_HCI"
        Title="P Email" 
        Icon="pack://application:,,,/Assets/logo_2.png"
        Height="600" Width="1000" MinHeight="400" MinWidth="800"
        FontFamily="Segoe UI">

    <!-- Import styles and theme resources -->
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Views/AppStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <!-- Main Layout Grid -->
    <Grid Background="{StaticResource DarkBackgroundColor}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Logo -->
            <RowDefinition Height="Auto"/> <!-- Menu -->
            <RowDefinition Height="*"/>    <!-- Main Content -->
        </Grid.RowDefinitions>

        <!-- (a) Logo Section -->
        <Grid Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Center">
            <Image Source="pack://application:,,,/Assets/logo.png"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Center"
                   Margin="10,0,0,0"
                   Width="40"
                   Height="40"/>
        </Grid>

        <!-- (b) Main Menu -->
        <Menu Grid.Row="1" Style="{StaticResource MenuStyleMain}">
            <MenuItem Header="File" Style="{StaticResource MenuItemStylePrimary}">
                <MenuItem.Icon>
                    <Image Width="16" Height="16" Source="pack://application:,,,/Assets/file.webp"/>
                </MenuItem.Icon>
                <MenuItem Header="Exit"
                          Click="Exit_Click"
                          Style="{StaticResource MenuItemStyleSecondary}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="pack://application:,,,/Assets/exit.png"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>

            <MenuItem Header="Message" Style="{StaticResource MenuItemStylePrimary}">
                <MenuItem.Icon>
                    <Image Width="16" Height="16" Source="pack://application:,,,/Assets/message.webp"/>
                </MenuItem.Icon>

                <MenuItem Header="New Static"
                          Command="{Binding AddStaticEmailCommand}"
                          Style="{StaticResource MenuItemStyleSecondary}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="pack://application:,,,/Assets/new-message.png"/>
                    </MenuItem.Icon>
                </MenuItem>

                <MenuItem Header="Edit Static"
                          Command="{Binding DataContext.EditDraftEmailCommand, ElementName=WindowRoot}"
                          Style="{StaticResource MenuItemStyleSecondary}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="pack://application:,,,/Assets/edit.png"/>
                    </MenuItem.Icon>
                </MenuItem>

                <MenuItem Header="New"
                          Click="NewEmail_Click"
                          Style="{StaticResource MenuItemStyleSecondary}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="pack://application:,,,/Assets/new-message.png"/>
                    </MenuItem.Icon>
                </MenuItem>

                <MenuItem Header="Edit"
                          x:Name="EditMenuItem"
                          IsEnabled="False"
                          Click="EditMenuItem_Click"
                          Style="{StaticResource MenuItemStyleSecondary}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="pack://application:,,,/Assets/edit.png"/>
                    </MenuItem.Icon>
                </MenuItem>

                <MenuItem Header="Delete"
                          Command="{Binding DataContext.DeleteEmailCommand, ElementName=WindowRoot}"
                          Style="{StaticResource MenuItemStyleSecondary}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="pack://application:,,,/Assets/delete.webp"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!-- (c) Main Content Layout -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/> <!-- Sidebar -->
                <ColumnDefinition Width="4*"/> <!-- Email List -->
                <ColumnDefinition Width="5*"/> <!-- Email Details -->
            </Grid.ColumnDefinitions>

            <!-- (c1) Sidebar TreeView -->
            <TreeView Name="FolderTree"
                      Grid.Column="0"
                      Margin="5"
                      Style="{StaticResource TreeViewStyleSidebar}"
                      SelectedItemChanged="FolderTree_SelectedItemChanged">
                <TreeView.ItemContainerStyle>
                    <StaticResource ResourceKey="TreeViewItemStyleSidebar"/>
                </TreeView.ItemContainerStyle>

                <TreeViewItem Header="Mailbox 1">
                    <TreeViewItem Header="Inbox" Tag="Inbox1"/>
                    <TreeViewItem Header="Sent" Tag="Sent1"/>
                    <TreeViewItem Header="Drafts" Tag="Drafts1"/>
                    <TreeViewItem Header="Trash" Tag="Trash1"/>
                </TreeViewItem>
                <TreeViewItem Header="Mailbox 2">
                    <TreeViewItem Header="Inbox" Tag="Inbox2"/>
                    <TreeViewItem Header="Sent" Tag="Sent2"/>
                    <TreeViewItem Header="Drafts" Tag="Drafts2"/>
                    <TreeViewItem Header="Trash" Tag="Trash2"/>
                </TreeViewItem>
            </TreeView>

            <!-- (c2) Email List Panel -->
            <Grid Grid.Column="1" Margin="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Search -->
                    <RowDefinition Height="Auto"/> <!-- Toggle Button -->
                    <RowDefinition Height="*"/>    <!-- List -->
                </Grid.RowDefinitions>

                <!-- SearchBarControl -->
                <local:SearchBarControl x:Name="SearchControl"
                                        Grid.Row="0"
                                        Margin="5"
                                        SearchChanged="SearchControl_SearchChanged"
                                        SearchReset="SearchControl_SearchReset"
                                        FilterChanged="SearchControl_FilterChanged"/>

                <!-- Toggle Button -->
                <Button Content="Toggle Important"
                        Grid.Row="1"
                        Margin="10"
                        HorizontalAlignment="Left"
                        Style="{StaticResource ButtonStylePrimary}"
                        Click="ToggleImportant_Click"/>

                <!-- Email List -->
                <ListView Name="EmailList"
                          ItemsSource="{Binding FilteredEmails}"
                          SelectedItem="{Binding SelectedEmail, Mode=TwoWay}"
                          Grid.Row="2"
                          Style="{StaticResource ListViewStyleEmail}"
                          MouseDoubleClick="EmailList_DoubleClick"
                          SelectionChanged="EmailList_SelectionChanged">
                    <ListView.ItemContainerStyle>
                        <StaticResource ResourceKey="ListViewItemStyleEmail"/>
                    </ListView.ItemContainerStyle>

                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource EmailBorderStyle}">
                                <StackPanel Orientation="Vertical">
                                    <TextBlock Text="{Binding Subject}" Style="{StaticResource EmailSubjectStyle}" />
                                    <TextBlock Text="{Binding Sender}" Style="{StaticResource EmailSenderStyle}" />
                                    <TextBlock Text="{Binding DateSent, StringFormat='{}{0:MMM dd, yyyy}'}"
           Style="{StaticResource EmailDateStyle}" />
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>


                </ListView>
            </Grid>

            <!-- (c3) Email Details Panel -->
            <Border Grid.Column="2" Margin="5" Padding="10" Background="{StaticResource LightBackgroundColor}">
                <StackPanel>
                    <TextBlock Text="{Binding SelectedEmail.Subject}" 
                               Style="{StaticResource TextBlockStyleDetailsSubject}" />
                    <TextBlock Text="{Binding SelectedEmail.Sender}" 
                               Style="{StaticResource TextBlockStyleDetailsSender}" />
                    <TextBlock Text="{Binding SelectedEmail.DateSent, StringFormat='{}{0:MMM dd, yyyy}'}" 
                               Style="{StaticResource TextBlockStyleDetailsDate}" />
                    <TextBlock Text="{Binding SelectedEmail.Content}" 
                               TextWrapping="Wrap" 
                               Style="{StaticResource TextBlockStyleDetailsContent}" />

                    <!-- Attachments Section -->
                    <StackPanel Orientation="Vertical" Margin="0,10,0,0">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Visible" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedEmail}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SelectedEmail.Attachments.Count}" Value="0">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>
                        <TextBlock Text="Attachments:"
                                   Style="{StaticResource TextBlockStyleDetailsAttachmentHeader}"/>
                        <ItemsControl ItemsSource="{Binding SelectedEmail.Attachments}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,3">
                                        <TextBlock Text="📎" FontSize="14" Margin="0,0,5,0"/>
                                        <TextBlock Text="{Binding}" Style="{StaticResource TextBlockStyleAttachmentItem}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
