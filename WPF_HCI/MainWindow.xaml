<Window x:Class="WPF_HCI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:WPF_HCI"
        xmlns:converters="clr-namespace:WPF_HCI.Converters"
        Title="Email Client" Height="600" Width="1000" MinHeight="400" MinWidth="800"
        FontFamily="Segoe UI">

    <!-- Window Resources -->
    <Window.Resources>
        <!-- Theme Colors -->
        <SolidColorBrush x:Key="DarkBackgroundColor" Color="#1A1A1A"/>
        <SolidColorBrush x:Key="LightBackgroundColor" Color="#333333"/>
        <SolidColorBrush x:Key="AccentBlueColor" Color="#3A7CA5"/>
        <SolidColorBrush x:Key="AccentGrayColor" Color="#A9A9A9"/>
        <SolidColorBrush x:Key="TextColor" Color="White"/>
        <SolidColorBrush x:Key="TextGrayColor" Color="#D3D3D3"/>
        <SolidColorBrush x:Key="LightGrayColor" Color="#D3D3D3"/>
        <SolidColorBrush x:Key="BorderColor" Color="#A9A9A9"/>
        <!-- Converters -->
        <converters:BooleanToTextConverter x:Key="BooleanToTextConverter"/>
    </Window.Resources>

    <Grid Background="{StaticResource DarkBackgroundColor}">
        <!-- Main Grid Rows: Logo, Menu, Main Content -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Logo -->
            <RowDefinition Height="Auto"/>
            <!-- Menu -->
            <RowDefinition Height="*"/>
            <!-- Main Content -->
        </Grid.RowDefinitions>

        <!-- (a) Logo -->
        <Grid Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Center">
            <Image Source="logo.png" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,0,0" Width="40" Height="40"/>
        </Grid>

        <!-- (b) Menu -->
        <Menu Grid.Row="1" Background="{StaticResource LightBackgroundColor}" Foreground="{StaticResource TextColor}">
            <MenuItem Header="File" Foreground="{StaticResource TextColor}">
                <MenuItem.Icon>
                    <Image Width="16" Height="16" Source="/file.webp"/>
                </MenuItem.Icon>
                <MenuItem Header="Exit" Click="Exit_Click" Foreground="{StaticResource DarkBackgroundColor}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="/exit.png"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="Message" Foreground="{StaticResource TextColor}">
                <MenuItem.Icon>
                    <Image Width="16" Height="16" Source="/message.webp"/>
                </MenuItem.Icon>
                <MenuItem Header="New Static" Foreground="{StaticResource DarkBackgroundColor}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="/new-message.png"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Edit Static" Foreground="{StaticResource DarkBackgroundColor}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="/edit.png"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="New" Foreground="{StaticResource DarkBackgroundColor}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="/new-message.png"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Edit" Foreground="{StaticResource DarkBackgroundColor}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="/edit.png"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Delete" Foreground="{StaticResource DarkBackgroundColor}">
                    <MenuItem.Icon>
                        <Image Width="16" Height="16" Source="/delete.webp"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!-- (c) Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <!-- Sidebar -->
                <ColumnDefinition Width="4*"/>
                <!-- Email List -->
                <ColumnDefinition Width="5*"/>
                <!-- Email Details -->
            </Grid.ColumnDefinitions>

            <!-- (c1) Sidebar: Mailbox TreeView -->
            <TreeView Name="FolderTree" Grid.Column="0" Margin="5"
                      Background="{StaticResource LightBackgroundColor}"
                      Foreground="{StaticResource TextGrayColor}" FontFamily="Segoe UI"
                      SelectedItemChanged="FolderTree_SelectedItemChanged">
                <TreeViewItem Header="Mailbox 1" Foreground="{StaticResource TextColor}">
                    <TreeViewItem Header="Inbox" Tag="Inbox1" Foreground="{StaticResource LightGrayColor}"/>
                    <TreeViewItem Header="Sent" Tag="Sent1" Foreground="{StaticResource LightGrayColor}"/>
                    <TreeViewItem Header="Drafts" Tag="Drafts1" Foreground="{StaticResource LightGrayColor}"/>
                    <TreeViewItem Header="Trash" Tag="Trash1" Foreground="{StaticResource LightGrayColor}"/>
                </TreeViewItem>
                <TreeViewItem Header="Mailbox 2" Foreground="{StaticResource TextColor}">
                    <TreeViewItem Header="Inbox" Tag="Inbox2" Foreground="{StaticResource LightGrayColor}"/>
                    <TreeViewItem Header="Sent" Tag="Sent2" Foreground="{StaticResource LightGrayColor}"/>
                    <TreeViewItem Header="Drafts" Tag="Drafts2" Foreground="{StaticResource LightGrayColor}"/>
                    <TreeViewItem Header="Trash" Tag="Trash2" Foreground="{StaticResource LightGrayColor}"/>
                </TreeViewItem>
            </TreeView>

            <!-- (c2) Email List Section -->
            <Grid Grid.Column="1" Margin="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Search & Filter -->
                    <RowDefinition Height="Auto"/>
                    <!-- Toggle Important Button -->
                    <RowDefinition Height="*"/>
                    <!-- Email List -->
                </Grid.RowDefinitions>

                <!-- Search and Filter -->
                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="5">
                    <TextBox Name="SearchBox" Width="200" Height="25" Text="Search..." Foreground="{StaticResource TextGrayColor}"
                             GotFocus="SearchBox_GotFocus" LostFocus="SearchBox_LostFocus" 
                             TextChanged="SearchBox_TextChanged" Background="{StaticResource LightBackgroundColor}" FontFamily="Segoe UI"/>
                    <ComboBox Name="FilterBox" Width="120" Height="25" SelectionChanged="FilterBox_SelectionChanged"
                              Background="{StaticResource LightBackgroundColor}" Foreground="{StaticResource DarkBackgroundColor}" FontFamily="Segoe UI">
                        <ComboBoxItem Content="All" IsSelected="True" Foreground="{StaticResource DarkBackgroundColor}"/>
                        <ComboBoxItem Content="Unread" Foreground="{StaticResource DarkBackgroundColor}"/>
                        <ComboBoxItem Content="Important" Foreground="{StaticResource DarkBackgroundColor}"/>
                    </ComboBox>
                </StackPanel>
                <!-- Toggle Important Button -->
                <Button Content="Toggle Important" Grid.Row="1" Margin="10" HorizontalAlignment="Left" Click="ToggleImportant_Click"/>
                <!-- Email List -->
                <ListView Name="EmailList" Grid.Row="2" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                          MouseDoubleClick="EmailList_DoubleClick" Background="{StaticResource LightBackgroundColor}" 
                          FontFamily="Segoe UI" Foreground="{StaticResource TextColor}" 
                          SelectionChanged="EmailList_SelectionChanged">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <!-- Enhanced Email Item -->
                            <Border x:Name="EmailBorder" Tag="{Binding}" BorderBrush="{StaticResource BorderColor}" BorderThickness="1" Padding="8" Margin="5" CornerRadius="8">
                                <Border.Effect>
                                    <DropShadowEffect Color="Black" BlurRadius="5" ShadowDepth="2" Opacity="0.3"/>
                                </Border.Effect>
                                <StackPanel Orientation="Vertical">
                                    <!-- Subject -->
                                    <TextBlock x:Name="SubjectTextBlock" Text="{Binding Subject}" FontWeight="Bold" FontSize="14" Margin="0,0,0,4"/>
                                    <!-- Sender -->
                                    <TextBlock x:Name="SenderTextBlock" Text="{Binding Sender}" FontStyle="Italic" FontSize="12" Margin="0,0,0,4"/>
                                    <!-- Date Sent -->
                                    <TextBlock x:Name="DateSentTextBlock" Text="{Binding DateSent, StringFormat='{}{0:MMM dd, yyyy}'}" FontSize="12" Margin="0,0,0,4"/>
                                    <!-- Recipients -->
                                    <TextBlock x:Name="RecipientsTextBlock" Text="{Binding Recipients}" FontSize="12" Foreground="{StaticResource TextGrayColor}" Margin="0,0,0,4"/>
                                    <!-- Preview of Content -->
                                    <TextBlock x:Name="PreviewTextBlock" Text="{Binding Content}" FontSize="12" Foreground="{StaticResource TextGrayColor}" TextTrimming="CharacterEllipsis" MaxHeight="40" Margin="0,0,0,4"/>
                                    <!-- Attachment Icon -->
                                    <TextBlock x:Name="AttachmentIcon" Text="📎" FontSize="14" Visibility="Visible"/>
                                </StackPanel>
                            </Border>
                            <DataTemplate.Triggers>
                                <!-- Hover Effect -->
                                <Trigger Property="Border.IsMouseOver" Value="True">
                                    <Setter TargetName="EmailBorder" Property="Background" Value="#444444"/>
                                </Trigger>
                                <!-- Important Email Style -->
                                <DataTrigger Binding="{Binding IsImportant}" Value="True">
                                    <Setter TargetName="EmailBorder" Property="Background" Value="IndianRed"/>
                                    <Setter TargetName="SubjectTextBlock" Property="Foreground" Value="White"/>
                                    <Setter TargetName="SenderTextBlock" Property="Foreground" Value="White"/>
                                    <Setter TargetName="DateSentTextBlock" Property="Foreground" Value="White"/>
                                    <Setter TargetName="RecipientsTextBlock" Property="Foreground" Value="White"/>
                                    <Setter TargetName="PreviewTextBlock" Property="Foreground" Value="White"/>
                                </DataTrigger>
                                <!-- Hide Attachment Icon if no attachments -->
                                <DataTrigger Binding="{Binding Attachments.Count}" Value="0">
                                    <Setter TargetName="AttachmentIcon" Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>

            <!-- (c3) Email Details Section (Right Column) -->
            <!-- (c3) Email Details Section (Right Column) -->
            <StackPanel Grid.Column="2" Margin="5" Background="{StaticResource LightBackgroundColor}">
                <!-- Display Selected Email Details -->
                <TextBlock Text="{Binding SelectedItem.Subject, ElementName=EmailList}" 
               FontWeight="Bold" Foreground="{StaticResource TextColor}" FontSize="16" Margin="0,0,0,5"/>
                <TextBlock Text="{Binding SelectedItem.Sender, ElementName=EmailList}" 
               Foreground="{StaticResource TextGrayColor}" FontStyle="Italic" FontSize="14" Margin="0,0,0,5"/>
                <TextBlock Text="{Binding SelectedItem.DateSent, StringFormat='{}{0:MMM dd, yyyy}', ElementName=EmailList}" 
               Foreground="{StaticResource TextGrayColor}" FontStyle="Italic" FontSize="14" Margin="0,0,0,5"/>
                <TextBlock Text="{Binding SelectedItem.Content, ElementName=EmailList}" 
               TextWrapping="Wrap" Foreground="{StaticResource TextColor}" FontSize="14" Margin="0,0,0,5"/>

                <!-- Attachments Panel: Hidden if no email is selected OR if attachments = 0 -->
                <StackPanel Orientation="Vertical" Margin="0,10,0,0">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <!-- Default: Visible -->
                            <Setter Property="Visibility" Value="Visible" />
                            <Style.Triggers>
                                <!-- Trigger 1: No email selected -->
                                <DataTrigger Binding="{Binding SelectedItem, ElementName=EmailList}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                                <!-- Trigger 2: Attachments count is zero -->
                                <DataTrigger Binding="{Binding SelectedItem.Attachments.Count, ElementName=EmailList}" Value="0">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <!-- Label -->
                    <TextBlock Text="Attachments:" FontWeight="Bold" Foreground="{StaticResource TextColor}" FontSize="14" Margin="0,0,0,5"/>

                    <!-- Attachments List -->
                    <ItemsControl ItemsSource="{Binding SelectedItem.Attachments, ElementName=EmailList}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,3">
                                    <TextBlock Text="📎" FontSize="14" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding}" FontSize="14" Foreground="{StaticResource TextColor}"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </StackPanel>

        </Grid>
    </Grid>
</Window>
